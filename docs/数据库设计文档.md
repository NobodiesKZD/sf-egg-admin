# 文档修订记录

| 日期       | 版本   | 说明 | 作者   |
| :--------- | :----- | :--- | :----- |
| 2020-08-21 | v1.0.0 | 创建 | 杨长源 |

# 文档简介

## 前言

该数据库主要针对八宝袋后端平台进行设计的，阐述了设计者的主要设计思想，为开发和实施人员提供参考依据，及在开发过程中注意事项进行了描述。该数据库是针对linux平台设计的，在设计过程中分为了系统规划阶段、需求分析阶段、概念设计阶段、逻辑设计阶段、物理设计阶段、系统实施阶段。在系统规划阶段主要是确定系统的名称、范围，确定系统开发的目标功能和性能，确定系统所需的资源，估计系统开发成本，分析用户环境及网络条件，建立系统的网络结构。需求分析阶段，主要是确定用户需求，包括数据需求和围绕这些数据的业务处理需求。在概念设计阶段，产生反映企业各组织信息需求的数据库概念结构，即概念模型，在物理设计阶段，主要任务是对数据库中数据在物理设备上的存放结构和存取方法进行设计，实施阶段，主要分为建立实际的数据库结构，装入试验数据对应用程序进行测试，装入实际数据建立实际数据库。  

## 编写目的

为了更详尽的介绍数据库配置内容以及数据库设计思想。

## 目标读者

此文档主要用于说明八宝袋移动端以及后端平台的数据结构，为系统开发和部署人员了解数据库提供开发参考。

## 主要内容

本文档主要阐述了数据库设计思想，数据库物理结构，表的设计以及表之间是如何关联的，为开发实施人员能更好的读懂数据结构提供参考依据。并介绍了各表的名称，包含的字段，字段描述以及字段长度，为开发人员能更好进行开发提供了方便。

# 参考文献

https://blog.csdn.net/gglinux/article/details/68948901

https://www.zybuluo.com/stonezhou/note/1292262

http://www.csdeshang.com/home/dsmall/database.html

https://www.bilibili.com/video/av75498379

# 数据库模型设计原则与思路

## 设计原则

简要描述数据模型设计中为了实现最大容量的数据存储和最快的查询响应所遵循的一些原则。
**1)**不是针对整个系统进行数据库设计，而是根据系统架构中的组件划分，针对每个组件所处理的业务进行组件单元的数据库设计；不同组件间所对应的数据库表之间的关联尽可能减少，如果不同组件间的表需要外键关联也尽量不要创建外键关联，而只是记录关联表的一个主键，确保组件对应的表之间的独立性，为系统或表结构的重构提供可能性。
**2)**采用领域模型驱动的方式和自顶向下的思路进行数据库设计，首先分析系统业务，根据职责定义对象。对象要符合封装的特性，确保与职责相关的数据项被定义在一个对象之内，这些数据项能够完整描述该职责，不会出现职责描述缺失。并且一个对象有且只有一项职责，如果一个对象要负责两个或两个以上的职责，应进行分拆。
**3)**根据建立的领域模型进行数据库表的映射，参考数据库设计第二范式：一个表中的所有非关键字属性都依赖于整个关键字。关键字可以是一个属性，也可以是多个属性的集合，不论那种方式，都应确保关键字能够保证唯一性。在确定关键字时，应保证关键字不会参与业务且不会出现更新异常，这时，采用一个自增数值型属性为表的关键字。
**4)**由于第一点所述的领域模型驱动的方式设计数据库表结构，领域模型中的每一个对象只有一项职责，所以对象中的数据项不存在传递依赖。
**5)**由于对象职责的单一性以及对象之间的关系反映的是业务逻辑之间的关系，所以在领域模型中的对象存在主对象和从对象之分，从对象是从1－N或N－N的角度进一步主对象的业务逻辑，所以从对象及对象关系映射为的表及表关联关系不存在删除和插入异常。
**6)**在映射后得出的数据库表结构中，根据第四范式进行进一步修改，确保不存在多值依赖。
**7)**在经过分析后确认所有的表都满足二、三、四范式，表和表之间的关联采用弱关联以便于对表字段和表结构的调整和重构。数据库中的表是用来持久化一个对象实例在特定时间及特定条件下的状态的，只是一个存储介质，表和表之间也不用强关联来表述业务（数据间的一致性），这一职责由系统的逻辑层来保证，确保了系统对于不正确数据（脏数据）的兼容性。
**8)**针对所有表的主键和外键建立索引，有针对性的（针对一些大数据量和常用检索方式）建立组合属性的索引，提高检索效率。

# 数据模型实体属性

## sys_menu

**表注释： 系统菜单**

| 字段      | 类型         | 空   | 默认 | 注释                            |
| --------- | ------------ | ---- | ---- | ------------------------------- |
| id        | bigint(20)   | 否   |      | 菜单ID                          |
| parentId  | bigint(20)   |      |      | 父菜单ID                        |
| name      | varchar(255) | 否   |      | 菜单名称                        |
| router    | varchar(255) |      |      | 菜单地址                        |
| perms     | varchar(255) |      |      | 权限标识                        |
| type      | tinyint(4)   | 否   | 0    | 类型，0：目录、1：菜单、2：按钮 |
| icon      | varchar(255) |      |      | 对应图标                        |
| order_num | int(11)      |      | 0    | 排序                            |
| view_path | varchar(255) |      |      | 视图地址，对应vue文件           |
| keepalive | boolean      |      | true | 路由缓存                        |
| Is_show   | boolean      |      | true | 是否显示在菜单栏                |

**索引**

| 键名    | 类型  | 唯一 | 紧凑 | 字段 | 基数 | 排序规则 | 空   | 注释 |
| ------- | ----- | ---- | ---- | ---- | ---- | -------- | ---- | ---- |
| PRIMARY | BTREE | 是   | 否   | id   | 0    | A        | 否   |      |

## sys_user

**表注释：系统用户**

| 字段          | 类型       | 空   | 默认 | 注释     |
| ------------- | ---------- | ---- | ---- | -------- |
| id            | bigint(20) | 否   |      | 用户ID   |
| department_id | bigint(20) | 否   |      | 部门编号 |
|               |            |      |      |          |

## sys_role

**表注释：系统角色**

| 字段    | 类型         | 空   | 默认 | 注释   |
| ------- | ------------ | ---- | ---- | ------ |
| id      | bigint(20)   | 否   |      | 角色ID |
| user_id | varchar(255) | 否   |      | 创建人 |
| name    | varchar(255) | 否   |      | 名称   |
| label   | varchar(50)  | 否   |      | 标签   |
| remark  | varchar(255) |      |      | 备注   |

**索引**

| 键名    | 类型  | 唯一 | 紧凑 | 字段  | 基数 | 排序规则 | 空   | 注释 |
| ------- | ----- | ---- | ---- | ----- | ---- | -------- | ---- | ---- |
| PRIMARY | BTREE | 是   | 否   | id    | 0    | A        | 否   |      |
| UNIQUE  | BTREE | 是   | 否   | label |      | A        | 否   |      |
| UNIQUE  | BTREE | 是   | 否   | name  |      | A        | 否   |      |

